# Code Header Format仕様

**目的**: AI検索可能なSwiftコードドキュメントの標準フォーマット
**対象**: 全Swiftファイル（Tools/, Library/, Domain/, App/, Infrastructure/, DI/）
**生成方法**: Claude自動生成
**利用方法**: Swift-Selena MCPによる検索・DB構築

---

## Code Header Format

既存ファイルヘッダーと互換性を持つシンプルなコメント形式

### セクション構成

1. **目的**（必要な数だけ箇条書き）
2. **主要機能**（必要な数だけ箇条書き、関数名なし）
3. **含まれる型**（複数型がある場合のみ）
4. **関連型**（該当する場合のみ）

### 原則

- **簡潔かつ十分な情報**
  - 冗長な表現を避ける
  - 必要な情報は必ず含める
  - 過度な省略禁止（理解できないレベルまで削らない）
- **生成AIが知っていること、容易に類推できることは記述しない**

### 書かないもの

- 関数名・メソッド名
- Protocol準拠（Sendable等）
- 使用パターン（コード例）
- 使用場所、制約、キーワード、レイヤー

---

## フォーマット詳細

### 基本構造

```swift
//
//  [ファイル名].swift
//  [プロジェクト名]
//
//  Created by ... on YYYY/MM/DD.
//
//  [Code Header Format]
//
//  目的
//  - [目的1]
//  - [目的2]
//
//  主要機能
//  - [機能1]
//  - [機能2]
//
//  含まれる型（該当する場合のみ）
//  - [型名]: [説明]
//
//  関連型（該当する場合のみ）
//  - [型名], [型名]
//

import Foundation
```

**重要**:
- `//` の後に**スペース2つ**（既存ヘッダーと同じ）
- **`[Code Header Format]` マーカー必須**（フォーマット済み判定に使用）

---

### 1. マーカー

```swift
//  [Code Header Format]
```

- **必須**: このマーカーでフォーマット済みを判定
- `Created by ...` の行の後、空行を挟んで配置

---

### 2. 目的

```swift
//  目的
//  - AsyncStreamの生成と購読者管理
//  - 自動リソースクリーンアップ（continuation.onTermination）
//  - 購読者数制限と監視
```

- 必要な数だけ箇条書き（3-5項目が目安だが、必要なら増減OK）
- なぜ存在するのか、何を解決するのか
- ファイル全体の目的を記述

---

### 3. 主要機能

```swift
//  主要機能
//  - Stream生成と購読者の自動管理
//  - データ配信（通常・条件付き）
//  - 履歴付きStream、重複除去Stream
```

- 必要な数だけ箇条書き（3-5項目が目安だが、必要なら増減OK）
- 何ができるのかを機能の説明で記述
- **関数名は書かない**（コードを読めば分かる）

---

### 4. 含まれる型（該当する場合のみ）

```swift
//  含まれる型
//  - ValidationRule: プロトコル定義
//  - ValidationResult: 検証結果enum
//  - RequiredRule, MinLengthRule, MaxLengthRule: 事前定義ルール
```

- 1ファイルに複数の型がある場合のみ記述
- 型名と簡潔な説明
- 1つの型しかない場合は省略

---

### 5. 関連型（該当する場合のみ）

```swift
//  関連型
//  - PhoneNumber, EmailAddress, ContactContainer
//  - CNContact（相互変換）
```

- 関連するSwift型をカンマ区切りで列挙
- 外部フレームワーク型は用途を括弧で補足
- 該当しない場合は省略

---

## Claude生成時の注意

### 生成方法

1. Read(file)でファイル全体を読み込む
2. **コードを理解する**（実装内容、ロジック、構造を把握）
3. Testファイルがあれば読んで使用例・意図を理解
4. 既存コメントがあれば参考にする（ただし鵜呑みにしない）
5. 理解した内容から目的・機能を記述
